{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": "Primary Forest â€” Annual Loss (Mha) vs Remaining (% of 2010)",
  "width": "container",
  "height": 450,

  "data": {
    "url": "https://raw.githubusercontent.com/chinsn2003/FIT3179_A2/refs/heads/main/data/treecover_loss_in_primary_forests_2001_tropics_only__ha.csv"
  },

  "transform": [
    {"calculate": "toNumber(datum.umd_tree_cover_loss__ha)/1e6", "as": "loss"},
    {"calculate": "toNumber(datum.umd_tree_cover_loss__year)", "as": "year"},
    {"filter": "datum.year >= 2010 && datum.year <= 2020"},
    {"filter": "isFinite(datum.loss) && datum.loss >= 0 && isFinite(datum.year)"},
    {"aggregate": [{"op": "sum", "field": "loss", "as": "sumLoss"}], "groupby": ["year"]},
    {"window": [{"op": "sum", "field": "sumLoss", "as": "cumLoss"}],
     "sort": [{"field": "year", "order": "ascending"}]},
    {"calculate": "1112.53482", "as": "baselineMha"},
    {"calculate": "datum.baselineMha - datum.cumLoss", "as": "remainingMha"},
    {"calculate": "datum.remainingMha / datum.baselineMha", "as": "remainingPct"}
  ],

  "resolve": { "scale": { "y": "independent" } },

  "layer": [
    {
      "mark": {"type": "line", "point": {"filled": true}},
      "encoding": {
        "x": {"field": "year", "type": "ordinal", "title": "Year"},
        "y": {
          "field": "sumLoss",
          "type": "quantitative",
          "title": "Primary forest loss (million ha)",
          "axis": {"orient": "left"}
        },
        "color": {"value": "#D55E00"},  
        "tooltip": [
          {"field": "year", "type": "ordinal", "title": "Year"},
          {"field": "sumLoss", "type": "quantitative", "title": "Primary forest loss (Mha)", "format": ",.2f"},
          {"field": "remainingPct", "type": "quantitative", "title": "Primary forest extent remaining", "format": ".1%"}
        ]
      }
    },

    {
      "mark": {"type": "line", "strokeDash": [4,4], "strokeWidth": 2, "point": {"filled": true}},
      "encoding": {
        "x": {"field": "year", "type": "ordinal"},
        "y": {
          "field": "remainingPct",
          "type": "quantitative",
          "axis": null   
        },
        "color": {"value": "#0072B2"}
      }
    },

    {
      "mark": {"type": "rule", "opacity": 0},
      "encoding": {
        "y": {
          "field": "remainingPct",
          "type": "quantitative",
          "axis": { "orient": "right", "format": ".0%", "grid": false,
                    "title": "Remaining primary forest (% of 2010)" }
        }
      }
    },

    {
      "data": {
        "values": [
          { "x": 300, "y": 30, "label": "Highest Loss\n(6.13 Mha) in 2016" },
          { "x": 520, "y": 25, "label": "96.3% of 2010\nremaining in 2020" }
        ]
      },
      "mark": {"type": "text", "aria": false, "align": "right",
               "fontSize": 12, "fontStyle": "italic", "color": "black","lineBreak": "\n"},
      "encoding": {
        "x": {"field": "x", "type": "quantitative", "scale": null},
        "y": {"field": "y", "type": "quantitative", "scale": null},
        "text": {"field": "label"}
      }
    }
  ],

  "config": {
    "axis": { "labelFontSize": 12, "titleFontSize": 12 }
  }
}
