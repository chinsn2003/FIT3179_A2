{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title": {"text": "Loss caused by different drivers over Time"},
  "width": 800,
  "height": 420,
  "data": {
    "url": "https://raw.githubusercontent.com/chinsn2003/FIT3179_A2/refs/heads/main/data/tree_cover_loss_by_driver.csv",
    "format": {"type": "csv"}
  },

  "params": [
    {
      "name": "driverSel",
      "select": {"type": "point", "fields": ["drivers_type"]},
      "bind": "legend"
    },
    {
      "name": "metric",
      "value": "loss",                     
      "bind": {
        "input": "select",
        "name": "Metric:",
        "options": ["loss", "emissions"],
        "labels": ["Forest loss (Mha)", "Gross carbon emissions (Mt)"]
      }
    }
  ],

  "transform": [
    {"calculate": "toNumber(datum.loss_area_ha)/1e6", "as": "Loss_M"},
    {"calculate": "toNumber(datum.gross_carbon_emissions_Mg)/1e6", "as": "Emissions_Mt"},
    {
      "calculate": "metric == 'loss' ? datum.Loss_M : datum.Emissions_Mt",
      "as": "yValue"
    },
    {
      "joinaggregate": [
        {"op": "sum", "field": "Loss_M", "as": "driver_total"}  
      ],
      "groupby": ["drivers_type"]
    },
    {"filter": {"param": "driverSel"}}
  ],

  "mark": {"type": "area"},

  "encoding": {
    "x": {"field": "loss_year", "type": "ordinal", "sort": "ascending", "axis": {"title": "Year"}},
    "y": {
      "aggregate": "sum",
      "field": "yValue",
      "type": "quantitative",
      "axis": {
        "title": "Loss (Mha) / Gross carbon emissions (Mt)"
      }
    },
    "color": {
      "field": "drivers_type",
      "type": "nominal",
      "title": "Driver",
      "sort": {"field": "driver_total", "op": "sum", "order": "descending"},
      "legend": {"title": "", "orient": "top-left", "cornerRadius": 6, "padding": 6, "columns": 2}
    },
    "order": {"field": "driver_total", "type": "quantitative", "sort": "descending"},
    "tooltip": [
      {"field": "drivers_type", "title": "Driver"},
      {"field": "loss_year", "title": "Year"},
      {
        "aggregate": "sum",
        "field": "yValue",
        "title": "Loss (Mha) / Emissions (Mt)",
        "format": ".2f"
      }
    ]
  },

  "config": {
    "axis": {"labelFontSize": 12, "titleFontSize": 12},
    "legend": {"labelFontSize": 12, "titleFontSize": 12}
  }
}
