{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "title":  "Drivers of Agriculture Deforestation (2013): CO₂ embodied in trade by product",
  "width": 800,
  "height": 420,
  "data": {
    "url": "https://raw.githubusercontent.com/chinsn2003/FIT3179_A2/refs/heads/main/data/deforestation-co2-trade-by-product.csv",
    "format": {"type": "csv"}
  },
  "transform": [
    {
      "fold": [
        "Cattle Meat",
        "Oilseed Products",
        "Other Crops",
        "Rice",
        "Vegetable/Fruits/Nuts",
        "Wheat",
        "Sugar",
        "Plant Fibres",
        "Other Meat Products",
        "Other Cereals"
      ],
      "as": ["Product","Val"]
    },
    {"calculate": "toNumber(datum.Val)", "as": "value"},
    {"filter": "isFinite(datum.value)"},
    {"aggregate": [{"op": "sum", "field": "value", "as": "total"}], "groupby": ["Product"]},
    {"joinaggregate": [{"op": "sum", "field": "total", "as": "grand"}]},
    {"calculate": "datum.total / datum.grand", "as": "share"},
    {"window": [{"op": "rank", "as": "rk"}], "sort": [{"field": "rk", "order": "descending"}]}
  ],
  "layer": [
    {
      "mark": {"type": "bar"},
      "encoding": {
        "y": {
          "field": "Product",
          "type": "nominal",
          "sort": {"field": "rk", "order": "descending"},
          "title": "Agriculture Products"
          
        },
        "x": {
          "field": "total",
          "type": "quantitative",
          "title": "CO₂ embodied in deforestation (total)",
          "axis": {"format": ",.0f"}
        },
        "color": {
          "condition": [
            {"test": "datum.rk == 1", "value": "#d62728"},  
            {"test": "datum.rk == 2", "value": "#1f77b4"}   
          ], 
          "value": "#bbb",
          "legend": null
        },
        "tooltip": [
          {"field": "Product", "title": "Product"},
          {"field": "total", "title": "CO₂ (t)", "format": ",.0f"},
          {"field": "share", "title": "Share of total", "format": ".1%"},
          {"field": "rk", "title": "Rank"}
        ]
      }
    },
    {
      "transform": [{"filter": "datum.rk <= 2"}],
      "mark": {"type": "text", "align": "left", "dx": 6, "baseline": "middle", "fontSize": 11, "fill": "#333"},
      "encoding": {
        "y": {"field": "Product", "type": "nominal", "sort": {"field": "total", "order": "descending"}},
        "x": {"field": "total", "type": "quantitative"},
        "text": {"field": "total", "type": "quantitative", "format": ",.0f"}
      }
    }
  ]}
